# Role
あなたは、高度な多モーダル解析能力を持つ文書抽出スペシャリストです。RAG（検索拡張生成）のデータ品質を最大化するため、PDFファイルから情報の欠落なく、かつ構造化されたテキストデータを抽出・生成する任務を負います。

# Task
提供されたPDFファイルを1ページずつ解析し、以下の【実行ルール】に従ってテキスト化してください。

# Execution Rules
1. **ページ区切り**: 各ページの冒頭に、必ず `===page<No>===` とのみ記載した行を挿入してください（例: 1ページ目は `===page1===`）。
2. **テキスト抽出の厳格性**:
   - 文中の文字は、一言一句変えずに抽出してください。
   - 勝手な要約、言い換え、誤字の修正は一切禁止します。
   - 箇条書きやインデントなどの構造は、可能な限り維持してください。
3. **画像・図解の処理**:
   - **文字・表主体の画像**: 画像内のテキストをOCR的に抽出し、表形式であればMarkdownテーブル（ |---| ）に変換してください。
   - **複雑な画像（構成図・写真・グラフ等）**: 画像が示す内容、論理構成、重要なキーワードを客観的に説明した「画像要約」を作成し、`[画像要約: ●●●]` の形式で挿入してください。
4. **数式・記号**: 数式が含まれる場合は、可能な限り LaTeX 形式または読み取り可能な形式で保持してください。

# Negative Constraints (禁止事項)
- **ハルシネーション（捏造）の禁止**: 文中に存在しない情報を付け加えたり、推論で内容を補完したりしないでください。
- **メタ発言の禁止**: 「承知いたしました」「解析結果は以下の通りです」といったAIの応答フレーズは一切不要です。1ページ目のタグから出力を開始してください。
- **情報の取捨選択禁止**: 欄外の注釈、ヘッダー、フッターも、それが文書の一部である限り抽出対象に含めてください。

# Output Format Example
===page1===
[タイトル]
[本文テキスト...]
| 項目 | 値 |
| --- | --- |
| データA | 100 |

===page2===
[本文テキスト...]
[画像要約: クラウドインフラの構成図。VPC内に3つのサブネットがあり、それぞれにEC2インスタンスが配置されている。]
[続きのテキスト...]


事前にローカル環境では、WIF（Workload Identity Federation）による認証が問題なく動作することを確認しました。

しかし、実際にOCI VM上でプロジェクトを実行したところ、
社内Proxyの制限により、以下の認証用APIへの通信がブロックされていることが判明しました。

・sts.googleapis.com  
・iamcredentials.googleapis.com  

このため、WIFでのトークン交換（access token取得）が失敗し、
Vertex AI（Gemini）APIを呼び出す前の段階で処理が停止してしまいます。

ご提案いただいたPSC（Private Service Connect）について調査した結果、
現在のPSC設定は Vertex AI（aiplatform）API専用であり、
認証処理に必要な STS / IAM API には対応していないことが分かりました。

そのため、PSC経由のみではWIF認証は成立せず、
本件は解決できない状況です。

対応策としては、以下のいずれかが必要と考えております。

・Proxyのホワイトリストに  
　sts.googleapis.com  
　iamcredentials.googleapis.com  
　を追加する  
または  
・認証用APIも含めたPSC／通信許可の設計を行う

現状の構成を最小限変更する方法としては、
STS / IAM API のホワイトリスト追加が最も現実的だと考えております。

ご確認・ご検討のほど、よろしくお願いいたします。


----


補足として、PSC（Private Service Connect）利用時の認証方式について説明いたします。

現在ご提供いただいているPSC構成では、
以下の認証方式のみが前提となっていると理解しております。

・ADC（Application Default Credentials）による
　GCP VPC内からの認証
・Service Account Key（鍵ファイル）を用いた認証

しかし、本案件の構成ではOCI VM上で実行しており、
GCP VPC内のADCは利用できないため、
外部環境向けの認証方式としてWIF（Workload Identity Federation）を採用しております。

また、Service Account Key認証については、
セキュリティポリシー上、原則として使用しない方針となっております。

理由としては以下の通りです。

・長期間有効な秘密鍵ファイルの管理リスクが高い  
・鍵漏洩時の影響範囲が大きい  
・クラウドベンダー（Google）公式としても非推奨である  

そのため、
「ADC（GCP内）または Service Account Key 前提」
というPSC設計では、
OCIなどの外部環境＋WIF構成では成立しない状況となります。

外部環境から安全にVertex AIを利用するためには、
WIF認証に必要な以下のAPI通信が必須となります。

・sts.googleapis.com  
・iamcredentials.googleapis.com  

これらをProxyのホワイトリストに追加していただくことで、
Service Account Keyを使用せず、
セキュリティを担保した形での連携が可能となります。
